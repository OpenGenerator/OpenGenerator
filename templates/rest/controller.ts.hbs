/**
 * {{pascalCase name}} Controller
 * Generated by OpenGenerator
 */

import type { Request, Response, NextFunction } from '{{adapterImport}}'
import type { {{pascalCase name}}Service } from './{{kebabCase name}}.service'
import type { Create{{pascalCase name}}Input, Update{{pascalCase name}}Input } from './{{kebabCase name}}.types'

export class {{pascalCase name}}Controller {
  constructor(private readonly service: {{pascalCase name}}Service) {}

  /**
   * Get all {{pluralize (lowerCase name)}}
   */
  async findAll(req: Request, res: Response, next: NextFunction): Promise<void> {
    try {
      const { page = 1, limit = 10, sort, order, ...filters } = req.query

      const result = await this.service.findAll({
        page: Number(page),
        limit: Number(limit),
        sort: sort as string,
        order: order as 'asc' | 'desc',
        filters,
      })

      res.json({
        data: result.data,
        meta: {
          total: result.total,
          page: result.page,
          limit: result.limit,
          totalPages: result.totalPages,
        },
      })
    } catch (error) {
      next(error)
    }
  }

  /**
   * Get {{lowerCase name}} by ID
   */
  async findById(req: Request, res: Response, next: NextFunction): Promise<void> {
    try {
      const { id } = req.params
      const result = await this.service.findById(id)

      if (!result) {
        res.status(404).json({
          error: '{{pascalCase name}} not found',
          code: '{{constantCase name}}_NOT_FOUND',
        })
        return
      }

      res.json({ data: result })
    } catch (error) {
      next(error)
    }
  }

  /**
   * Create new {{lowerCase name}}
   */
  async create(req: Request, res: Response, next: NextFunction): Promise<void> {
    try {
      const input: Create{{pascalCase name}}Input = req.body
      const result = await this.service.create(input)

      res.status(201).json({ data: result })
    } catch (error) {
      next(error)
    }
  }

  /**
   * Update {{lowerCase name}}
   */
  async update(req: Request, res: Response, next: NextFunction): Promise<void> {
    try {
      const { id } = req.params
      const input: Update{{pascalCase name}}Input = req.body

      const result = await this.service.update(id, input)

      if (!result) {
        res.status(404).json({
          error: '{{pascalCase name}} not found',
          code: '{{constantCase name}}_NOT_FOUND',
        })
        return
      }

      res.json({ data: result })
    } catch (error) {
      next(error)
    }
  }

  /**
   * Delete {{lowerCase name}}
   */
  async delete(req: Request, res: Response, next: NextFunction): Promise<void> {
    try {
      const { id } = req.params
      const deleted = await this.service.delete(id)

      if (!deleted) {
        res.status(404).json({
          error: '{{pascalCase name}} not found',
          code: '{{constantCase name}}_NOT_FOUND',
        })
        return
      }

      res.status(204).send()
    } catch (error) {
      next(error)
    }
  }
}

/**
 * OpenGenerator Configuration
 * Generated by OpenGenerator
 */

import { defineConfig } from 'opengenerator'

export default defineConfig({
  // Schema source
  schema: '{{schemaPath}}',

  // Output directory
  output: '{{outputPath}}',

  // API configuration
  api: {
    {{#if rest}}
    rest: {
      enabled: true,
      prefix: '{{apiPrefix}}',
      {{#if swagger}}
      swagger: {
        enabled: true,
        path: '/docs',
        title: '{{projectName}} API',
        version: '{{version}}',
      },
      {{/if}}
    },
    {{/if}}
    {{#if graphql}}
    graphql: {
      enabled: true,
      path: '/graphql',
      {{#if subscriptions}}
      subscriptions: true,
      {{/if}}
      {{#if playground}}
      playground: process.env.NODE_ENV !== 'production',
      {{/if}}
    },
    {{/if}}
    {{#if trpc}}
    trpc: {
      enabled: true,
      path: '/trpc',
    },
    {{/if}}
  },

  // Server adapter
  adapter: '{{adapter}}',

  {{#if auth}}
  // Authentication
  auth: {
    strategies: [{{#each authStrategies}}'{{this}}'{{#unless @last}}, {{/unless}}{{/each}}],
    {{#if jwt}}
    jwt: {
      secret: process.env.JWT_SECRET!,
      expiresIn: '{{jwt.expiresIn}}',
      refreshExpiresIn: '{{jwt.refreshExpiresIn}}',
    },
    {{/if}}
    {{#if oauth}}
    oauth: {
      providers: [{{#each oauthProviders}}'{{this}}'{{#unless @last}}, {{/unless}}{{/each}}],
    },
    {{/if}}
  },
  {{/if}}

  // Database configuration
  database: {
    adapter: '{{database}}',
    {{#if postgres}}
    connection: {
      url: process.env.DATABASE_URL!,
    },
    {{/if}}
  },

  {{#if deploy}}
  // Deployment configuration
  deploy: [{{#each deployTargets}}'{{this}}'{{#unless @last}}, {{/unless}}{{/each}}],
  {{/if}}

  // Code generation options
  codegen: {
    // Generate TypeScript types
    types: true,
    // Generate Zod schemas
    validation: {{#if validation}}true{{else}}false{{/if}},
    // Generate test files
    tests: {{#if tests}}true{{else}}false{{/if}},
    // Soft delete support
    softDelete: {{#if softDelete}}true{{else}}false{{/if}},
    // Audit fields (createdBy, updatedBy)
    audit: {{#if audit}}true{{else}}false{{/if}},
  },

  // Custom templates directory (optional)
  {{#if customTemplates}}
  templates: '{{customTemplates}}',
  {{/if}}

  // Hooks
  hooks: {
    // Run before generation
    beforeGenerate: async (context) => {
      console.log('Starting generation...')
    },
    // Run after generation
    afterGenerate: async (context) => {
      console.log(`Generated ${context.filesWritten} files`)
    },
  },
})
